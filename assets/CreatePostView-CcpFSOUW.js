import{z as D,u as F,k as M,A as P,l as a,r as R,c as i,a as e,t as C,d as A,_ as N,e as h,w as z,n as p,v as g,g as E,p as L,B as j,F as q,s as $,b as G,o as l,q as H}from"./index-82YUfLJa.js";const I={class:"page-wrapper"},J={class:"container-xl"},K={class:"page-header d-print-none"},O={class:"row g-2 align-items-center"},Q={class:"col"},W={class:"page-title"},X={class:"page-body"},Y={class:"container-xl"},Z={class:"row row-cards"},ee={class:"col-12"},se={class:"row"},te={form:"form-fieldset"},oe={class:"mb-3"},ae=e("label",{for:"title",class:"form-label"},"Title",-1),le={class:"mb-3"},re=e("label",{for:"title",class:"form-label"},"Contenue",-1),ne={class:"form-label mb-3"},ie={key:0,class:"mb-3",width:"150",height:"150"},de=["src"],ce={key:1,class:"progress mb-2"},ue={class:"mb-3"},pe=e("label",{for:"title",class:"form-label"},"Category",-1),ve=["value"],me=e("button",{type:"submit",class:"btn btn-primary"},"Envoyer",-1),he={__name:"CreatePostView",setup(_e){var w;const y=D(),k=F(),x=M(),{categories:S}=P(y),{getCategories:U}=y;U();const r=a(0),d=a((w=k.getUser)==null?void 0:w.id),n=a(""),c=a(""),b=a(null),v=a(!1),u=R({errors:[]}),m=a(null),_=a(null),f=a(0),V=o=>{r.value=o.target.value},T=o=>{b.value=_.value=o.target.files[0];const s=new FileReader;s.onload=function(t){m.value=t.target.result},s.readAsDataURL(o.target.files[0])},B=async()=>{u.errors=[];const o=new FormData;o.append("title",n.value),o.append("content",c.value),o.append("file",_.value),o.append("user_id",d.value),o.append("category_id",r.value),await H.post("/post/store",o,{headers:{"Content-Type":"multipart/form-data;charset=utf-8"},onUploadProgress:s=>{if(n.value&&c.value&&_.value&&d.value&&r.value){v.value=!0;let t=Math.round(s.loaded*100/s.total);f.value=t,t===100&&setTimeout(()=>{f.value=0,v.value=!1,x.push({name:"home"})},2e3)}}}).then(s=>{console.log(s)}).catch(s=>{if(console.log(s),s.response.status===422)for(const t in s.response.data.errors)u.errors.push(s.response.data.errors[t][0]+" ")})};return(o,s)=>(l(),i("div",I,[e("div",J,[e("div",K,[e("div",O,[e("div",Q,[e("h2",W,C(n.value),1)])])])]),e("div",X,[e("div",Y,[e("div",Z,[e("div",ee,[u.errors.length?(l(),A(N,{key:0,errors:u.errors},null,8,["errors"])):h("",!0),e("form",{onSubmit:z(B,["prevent"]),action:"/post/store",method:"post",enctype:"multipart/form-data"},[p(e("input",{type:"hidden",name:"user_id","onUpdate:modelValue":s[0]||(s[0]=t=>d.value=t)},null,512),[[g,d.value]]),e("div",se,[e("fieldset",te,[e("div",oe,[ae,p(e("input",{type:"text",class:"form-control",placeholder:"title",autofocus:"","onUpdate:modelValue":s[1]||(s[1]=t=>n.value=t)},null,512),[[g,n.value]])]),e("div",le,[re,p(e("textarea",{class:"form-control",placeholder:"title","onUpdate:modelValue":s[2]||(s[2]=t=>c.value=t)},null,512),[[g,c.value]])]),e("div",ne,[E(" Ajouter une image "),e("input",{onChange:s[3]||(s[3]=t=>T(t)),ref_key:"fil",ref:b,type:"file",class:"form-control"},null,544),m.value?(l(),i("div",ie,[e("img",{src:m.value,alt:"image",class:"img-fluid",width:"150",height:"150"},null,8,de)])):h("",!0),v.value?(l(),i("div",ce,[e("div",{class:"progress-bar",style:L("width:"+f.value+"%")},null,4)])):h("",!0)]),e("div",ue,[pe,p(e("select",{onChange:s[4]||(s[4]=t=>V(t)),class:"form-control",placeholder:"selectionner une category","onUpdate:modelValue":s[5]||(s[5]=t=>r.value=t)},[(l(!0),i(q,null,$(G(S),t=>(l(),i("option",{key:t.id,value:t.id},C(t.name),9,ve))),128))],544),[[j,r.value]])])]),me])],32)])])])])]))}};export{he as default};
